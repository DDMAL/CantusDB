<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <title>Search Chants (Printer-Friendly) | Cantus Manuscript Database</title>
    
    <!-- Required meta tags -->
    <meta name="robots" content="noindex">
    <meta name="google-site-verification" content="EwxpNpZ_ZOQnetVVLELGn5-aD_beT3EQqUuI6glkArI" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, 
    initial-scale=1, shrink-to-fit=no">

    <link rel="icon" href="{% static "favicon.ico" %}">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">

    <!-- font-awesome CSS for icons -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- JS, Popper.js, and jQuery -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>

    <script src="/static/js/chant_search.js"></script>
    <style>
        html {
            position: relative;
            min-height: 90%;
        }

        body {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 15px;
            height: 100%;
        }

        a {
            color: rgb(100,100,100);
        }

        a:hover {
            color: rgb(200,200,200);
            text-decoration: none;
        }

        table {
            padding: 0px;
            font-size: 70%;
            line-height: normal;
        }

        table, th, td {
            border: 1px solid;
        }
    </style>
    <link href="{% static 'fonts/volpiano.css' %}" rel="stylesheet" media="screen">
</head>

<div class="mr-3 p-3 col-md-12 mx-auto bg-white rounded">
    <p>
        « <a href="{{ main_chant_search_url }}">Return to main search page</a>
    </p>
    {% if source %}
        <b>Searching in source: <a href="{{ source.get_absolute_url }}" target="_blank">{{ source.title }}</a></b>
    {% endif %}

    {% if chants.all %}
        <small>Displaying {{ page_obj.start_index }}-{{ page_obj.end_index }} of <b>{{ page_obj.paginator.count }}
                chants</b></small>
    {% endif %}

    <form method="get">
        <div class="form-row align-items-end">
            <div class="form-group m-1 col-lg">
                <select class="form-control custom-select custom-select-sm" id="opFilter" name="op">
                    <option selected value="contains">Contains</option>
                    <option value="starts_with">Starts with</option>
                </select>
            </div>
            <div class="form-group m-1 col-lg">
                <label for="keywordSearch"><small>Keyword search</small></label>
                <input type="text" class="form-control form-control-sm" name="keyword" id="keywordSearch" value="{{ request.GET.keyword }}">
            </div>
        </div>
        <div class="form-row align-items-end">
            <div class="form-group m-1 col-lg">
                <label for="office"><small>Office/Mass</small></label>
                <input type="text" class="form-control form-control-sm" name="office" id="office" value="{{ request.GET.office }}">
            </div>
            <div class="form-group m-1 col-lg">
                <label for="genreFilter"><small>Genre</small></label>
                <select id="genreFilter" name="genre" class="form-control custom-select custom-select-sm">
                    <option value="">- Any -</option>
                    {% for genre in genres %}
                        <option value="{{ genre.id }}">{{ genre.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group m-1 col-lg">
                <label for="cantus_id"><small>Cantus ID</small></label>
                <input type="text" class="form-control form-control-sm" name="cantus_id" id="cantus_id" value="{{ request.GET.cantus_id }}">
            </div>
            <div class="form-group m-1 col-lg">
                <label for="mode"><small>Mode</small></label>
                <input type="text" class="form-control form-control-sm" name="mode" id="mode" value="{{ request.GET.mode }}">
            </div>
            <div class="form-group m-1 col-lg">
                <label for="feast"><small>Feast</small></label>
                <input type="text" class="form-control form-control-sm" name="feast" id="feast" value="{{ request.GET.feast }}">
            </div>
            <div class="form-group m-1 col-lg">
                <label for="position"><small>Position</small></label>
                <input type="text" class="form-control form-control-sm" name="position" id="position" value="{{ request.GET.position }}">
            </div>
            <div class="form-group m-1 col-lg">
                <label for="melodiesFilter"><small>Melodies</small></label>
                <select class="form-control custom-select custom-select-sm" id="melodiesFilter" name="melodies">
                    <option value="">- Any -</option>
                    <option value="true">Chants with melodies</option>
                    <option value="false">Chants without melodies</option>
                </select>
            </div>
        </div>

        <div class="form-row align-items-end">
            <div class="form-group m-1 col-lg">
                <button type="submit" class="btn btn-dark btn-sm" id="btn-submit"> Apply </button>
            </div>
        </div>
        
    </form>

    {% if chants.all %}
        <small>
            <table>
                <thead>
                    <tr>
                        <th scope="col" class="text-wrap" style="text-align:center">
                            {% if order == "siglum" %}
                                {% if sort == "desc" %}
                                    <a href="{{ url_with_search_params }}&order=siglum&sort=asc">Siglum</a> ▼
                                {% else %}
                                    <a href="{{ url_with_search_params }}&order=siglum&sort=desc">Siglum</a> ▲
                                {% endif %}
                            {% else %}
                                <a href="{{ url_with_search_params }}&order=siglum&sort=asc">Siglum</a>
                            {% endif %}
                        </th>
                        <th scope="col" class="text-wrap" style="text-align:center">
                            Folio
                        </th>
                        <th scope="col" class="text-wrap" style="text-align:center">
                            {% if order == "incipit" %}
                                {% if sort == "desc" %}
                                    <a href="{{ url_with_search_params }}&order=incipit&sort=asc">Incipit</a> ▼
                                {% else %}
                                    <a href="{{ url_with_search_params }}&order=incipit&sort=desc">Incipit</a> ▲
                                {% endif %}
                            {% else %}
                                <a href="{{ url_with_search_params }}&order=incipit&sort=asc">Incipit</a>
                            {% endif %}
                        </th>
                        <th scope="col" class="text-wrap" style="text-align:center">
                            Feast
                        </th>
                        <th scope="col" class="text-wrap" style="text-align:center">
                            {% if order == "office" %}
                                {% if sort == "desc" %}
                                    <a href="{{ url_with_search_params }}&order=office&sort=asc">Office<br>/Mass</a> ▼
                                {% else %}
                                    <a href="{{ url_with_search_params }}&order=office&sort=desc">Office<br>/Mass</a> ▲
                                {% endif %}
                            {% else %}
                                <a href="{{ url_with_search_params }}&order=office&sort=asc">Office<br>/Mass</a>
                            {% endif %}
                        </th>
                        <th scope="col" class="text-wrap" style="text-align:center">
                            {% if order == "genre" %}
                                {% if sort == "desc" %}
                                    <a href="{{ url_with_search_params }}&order=genre&sort=asc">Genre</a> ▼
                                {% else %}
                                    <a href="{{ url_with_search_params }}&order=genre&sort=desc">Genre</a> ▲
                                {% endif %}
                            {% else %}
                                <a href="{{ url_with_search_params }}&order=genre&sort=asc">Genre</a>
                            {% endif %}
                        </th>
                        <th scope="col" class="text-wrap" style="text-align:center">
                            Position
                        </th>
                        <th scope="col" class="text-wrap" style="text-align:center">
                            {% if order == "cantus_id" %}
                                {% if sort == "desc" %}
                                    <a href="{{ url_with_search_params }}&order=cantus_id&sort=asc">Cantus ID</a> ▼
                                {% else %}
                                    <a href="{{ url_with_search_params }}&order=cantus_id&sort=desc">Cantus ID</a> ▲
                                {% endif %}
                            {% else %}
                                <a href="{{ url_with_search_params }}&order=cantus_id&sort=asc">Cantus ID</a>
                            {% endif %}
                        </th>
                        <th scope="col" class="text-wrap" style="text-align:center">
                            {% if order == "mode" %}
                                {% if sort == "desc" %}
                                    <a href="{{ url_with_search_params }}&order=mode&sort=asc">Mode</a> ▼
                                {% else %}
                                    <a href="{{ url_with_search_params }}&order=mode&sort=desc">Mode</a> ▲
                                {% endif %}
                            {% else %}
                                <a href="{{ url_with_search_params }}&order=mode&sort=asc">Mode</a>
                            {% endif %}
                        </th>
                        <th scope="col" class="text-wrap" style="text-align:center">
                            {% if order == "has_fulltext" %}
                                {% if sort == "desc" %}
                                    <a href="{{ url_with_search_params }}&order=has_fulltext&sort=asc">MsFt</a> ▼
                                {% else %}
                                    <a href="{{ url_with_search_params }}&order=has_fulltext&sort=desc">MsFt</a> ▲
                                {% endif %}
                            {% else %}
                                <a href="{{ url_with_search_params }}&order=has_fulltext&sort=asc">MsFt</a>
                            {% endif %}
                        </th>
                        <th scope="col" class="text-wrap" style="text-align:center">
                            {% if order == "has_melody" %}
                                {% if sort == "desc" %}
                                    <a href="{{ url_with_search_params }}&order=has_melody&sort=asc">Mel</a> ▼
                                {% else %}
                                    <a href="{{ url_with_search_params }}&order=has_melody&sort=desc">Mel</a> ▲
                                {% endif %}
                            {% else %}
                                <a href="{{ url_with_search_params }}&order=has_melody&sort=asc">Mel</a>
                            {% endif %}
                        </th>
                        <th scope="col" class="text-wrap" style="text-align:center">
                            {% if order == "has_image" %}
                                {% if sort == "desc" %}
                                    <a href="{{ url_with_search_params }}&order=has_image&sort=asc">Image</a> ▼
                                {% else %}
                                    <a href="{{ url_with_search_params }}&order=has_image&sort=desc">Image</a> ▲
                                {% endif %}
                            {% else %}
                                <a href="{{ url_with_search_params }}&order=has_image&sort=asc">Image</a>
                            {% endif %}
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for chant in chants %}
                        <tr>
                            <td class="text-wrap" style="text-align:left">
                                <a href="{{ chant.source.get_absolute_url }}">{{ chant.source.siglum }}</a>
                            </td>
                            <td class="text-wrap" style="text-align:center">
                                {{ chant.folio|default:"" }}
                            </td>

                            <td class="text-wrap" style="text-align:left">
                                {% comment %} this is used for distinguishing chants from sequences,
                                if the object is chant, use chant.get_absolute_url,
                                otherwise, use sequence.get_absolute_url
                                the combined queryset turned all objects into chants
                                so this is the only way to make the distinction {% endcomment %}
                                {% if chant.search_vector %}
                                    <b><a href="{{ chant.get_absolute_url }}">{{ chant.incipit|default:"" }}</a></b>
                                {% else %}
                                    <b><a href="{% url 'sequence-detail' chant.id %}">{{ chant.incipit|default:"" }}</a></b>
                                {% endif %}
                            </td>
                            <td class="text-wrap" style="text-align:center">
                                <a href="{{ chant.feast.get_absolute_url }}">{{ chant.feast.name|default:"" }}</a>
                            </td>
                            <td class="text-wrap" style="text-align:center">
                                <a href="{{ chant.office.get_absolute_url }}">{{ chant.office.name|default:"" }}</a>
                            </td>
                            <td class="text-wrap" style="text-align:center">
                                <a href="{{ chant.genre.get_absolute_url }}">{{ chant.genre.name|default:"" }}</a>
                            </td>
                            <td class="text-wrap" style="text-align:center">
                                {{ chant.position|default:"" }}
                            </td>
                            <td class="text-wrap" style="text-align:center">
                                <a href="{{ chant.get_ci_url }}" target="_blank">{{chant.cantus_id|default:"" }}</a>
                            </td>
                            <td class="text-wrap" style="text-align:center">
                                {{ chant.mode|default:"" }}
                            </td>
                            <td class="text-wrap" style="text-align:center">
                                {% if chant.manuscript_full_text %}
                                    <span title="Chant record includes Manuscript Full Text">✔</span>
                                {% endif %}
                            </td>
                            <td class="text-wrap" style="text-align:center">
                                {% if chant.volpiano %}
                                    <span title="Chant record has Volpiano melody">♫</span>
                                {% endif %}
                            </td>
                            <td class="text-wrap" style="text-align:center">
                                {% if chant.image_link %}
                                    <a href="{{ chant.image_link }}" target="_blank">Image</a>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </small>

        {% include "pagination.html" %}
    {% endif %}
</div>
</html>